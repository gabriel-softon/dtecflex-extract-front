<div class="container pt-5">

  <div class="mb-3">
    <div class="form-check form-check-inline">
      <input class="form-check-input"
             type="radio"
             name="modoPublicacao"
             id="modoRegistro"
             [(ngModel)]="modo"
             (ngModelChange)="onModoChange($event)"
             [value]="'registro'">
      <label class="form-check-label" for="modoRegistro">Publicar por registro</label>
    </div>

    <div class="form-check form-check-inline">
      <input class="form-check-input"
             type="radio"
             name="modoPublicacao"
             id="modoData"
             [(ngModel)]="modo"
             (ngModelChange)="onModoChange($event)"
             [value]="'data'">
      <label class="form-check-label" for="modoData">Publicar por data</label>
    </div>
  </div>

  <div *ngIf="modo === 'registro'" class="mb-4">
    <label class="form-label" for="registroInput">Registro</label>
    <input id="registroInput"
           type="text"
           class="form-control"
           [(ngModel)]="registroInput"
           placeholder="Digite o registro">
    <div class="form-text">Por enquanto não executa publicação — apenas exibe no console.</div>
  </div>

  <div *ngIf="modo === 'data'" class="mb-4">
    <label class="form-label" for="dataInput">Data</label>
    <input id="dataInput"
          type="date"
          class="form-control"
          [(ngModel)]="dataInput"
          (change)="onDateChange($event.target.value)">
    <div class="form-text">Ao selecionar a data, a listagem será filtrada automaticamente.</div>
  </div>

  <div class="d-flex align-items-center gap-2">
    <button class="btn btn-primary"
            (click)="publicar()"
            [disabled]="isLoading || isPublishing">
      {{ isPublishing ? 'Publicando…' : (isLoading ? 'Processando...' : 'Publicar') }}
    </button>
    <div *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-label="Carregando listagem"></div>
  </div>

  <div *ngIf="mensagem" class="alert alert-info mt-3" role="alert" aria-live="polite">
    {{ mensagem }}
  </div>

  <div *ngIf="isPublishing" class="mt-4 d-flex flex-column align-items-center justify-content-center py-5" aria-live="polite">
    <div class="spinner-border" style="width:3rem;height:3rem" role="status" aria-hidden="true"></div>
    <div class="mt-3 fw-semibold">{{ publishLabel }}</div>
  </div>

  <div *ngIf="noticias?.length && !isPublishing" class="mt-4">
    <h5 class="mb-3">Resultados</h5>

    <div class="row g-3">
      <div class="col-12 col-md-6 col-lg-4" *ngFor="let n of noticias">
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column">
            <h6 class="card-title mb-2" [title]="n?.TITULO || 'Sem título'">
              {{ n?.TITULO || 'Sem título' }}
            </h6>

            <div class="mb-3 small text-muted">
              <span class="fw-semibold">Registro:</span>
              <span class="ms-1">{{ n?.REG_NOTICIA ?? '—' }}</span>
            </div>

            <div class="mt-auto">
              <div class="d-flex flex-wrap gap-1" *ngIf="n?.nomes_raspados?.length; else semNomes">
                <span class="badge text-bg-secondary" *ngFor="let p of n.nomes_raspados">
                  {{ p?.NOME || 'Sem nome' }}<ng-container *ngIf="p?.ENVOLVIMENTO"> — {{ p.ENVOLVIMENTO }}</ng-container>
                </span>
              </div>
              <ng-template #semNomes>
                <span class="text-muted small">Sem nomes raspados</span>
              </ng-template>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

</div>
